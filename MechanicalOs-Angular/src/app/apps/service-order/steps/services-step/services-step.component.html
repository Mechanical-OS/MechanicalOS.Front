<div class="row">
    <!-- Card de Resumo dos Dados Cadastrados -->
    <div class="col-12 mb-3">
        <div class="card border-primary">
            <div class="card-body">
                <h5 class="card-title text-primary">
                    <i class="fas fa-info-circle me-2"></i>Resumo dos Dados Cadastrados
                </h5>
                
                <div class="row" *ngIf="draftSummary">
                    <div class="col-md-4">
                        <div class="mb-2">
                            <strong>Cliente:</strong><br>
                            <span class="me-2">{{ getCustomerStatusIcon() }}</span>
                            <small class="text-muted">{{ getCustomerStatusText() }}</small><br>
                            {{ draftSummary.customer }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-2">
                            <strong>Ve√≠culo:</strong><br>
                            <span class="me-2">{{ getVehicleStatusIcon() }}</span>
                            <small class="text-muted">{{ getVehicleStatusText() }}</small><br>
                            {{ draftSummary.vehicle }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-2">
                            <strong>Endere√ßo:</strong><br>
                            <span class="me-2">{{ getAddressStatusIcon() }}</span>
                            <small class="text-muted">{{ getAddressStatusText() }}</small><br>
                            {{ draftSummary.address }}
                        </div>
                    </div>
                </div>

                <div class="alert alert-info mb-0 mt-2" role="alert">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Legenda:</strong> üîµ Registro existente no banco | üü¢ Novo registro (ser√° criado)
                </div>
            </div>
        </div>
    </div>

    <!-- Se√ß√£o de servi√ßos -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Servi√ßos a serem realizados...</h5>
                
                <!-- Campo de busca -->
                <div class="services-search-section">
                    <app-service-search
                        placeholder="Pesquise por c√≥digo ou nome do servi√ßo (m√≠nimo 3 caracteres)"
                        [minCharacters]="3"
                        [debounceTime]="500"
                        [showPriceInList]="true"
                        [showCodeBadge]="true"
                        [clearOnSelect]="false"
                        [resultLimit]="10"
                        (serviceSelected)="addService($event)"
                        (searchError)="onSearchError($event)">
                    </app-service-search>
                </div>

                <!-- Tabela de servi√ßos selecionados -->
                <div class="services-table-container" *ngIf="services.length > 0">
                    <table class="table table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>SERVI√áO</th>
                                <th>Pre√ßo</th>
                                <th>Quantidade</th>
                                <th>Total</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let service of services; let i = index">
                                <td>{{ service.name }}</td>
                                <td>R$ {{ service.price.toFixed(2).replace('.', ',') }}</td>
                                <td>
                                    <input 
                                        type="number" 
                                        class="form-control form-control-sm" 
                                        style="width: 80px;"
                                        [value]="service.quantity"
                                        min="1"
                                        (change)="updateServiceQuantity(i, $any($event.target).value)"
                                        (input)="updateServiceQuantity(i, $any($event.target).value)">
                                </td>
                                <td>R$ {{ service.total.toFixed(2).replace('.', ',') }}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button 
                                            class="btn btn-sm btn-outline-danger" 
                                            (click)="removeService(i)"
                                            title="Remover servi√ßo">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Se√ß√£o de descri√ß√£o/observa√ß√µes -->
                <div class="mt-4">
                    <h6>Descri√ß√£o / Observa√ß√µes</h6>
                    <textarea 
                        class="form-control" 
                        rows="4" 
                        placeholder="Digite a descri√ß√£o e observa√ß√µes da ordem de servi√ßo..."
                        [(ngModel)]="description"
                        (blur)="updateDescription()">
                    </textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Se√ß√£o de resumo do or√ßamento -->
    <div class="col-md-4">
        <div class="card resumo-orcamento-fixed">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-calculator me-2"></i>Resumo do or√ßamento
                </h5>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Sub total:</span>
                        <span><strong>R$ {{ subtotal.toFixed(2).replace('.', ',') }}</strong></span>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Desconto:</span>
                        <span class="text-danger">- R$ {{ discount.toFixed(2).replace('.', ',') }}</span>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Taxas:</span>
                        <span>R$ 0,00</span>
                    </div>
                </div>

                <hr>

                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span><strong>Total:</strong></span>
                        <span><strong class="text-success fs-5">R$ {{ total.toFixed(2).replace('.', ',') }}</strong></span>
                    </div>
                </div>

                <!-- Campo de cupom de desconto -->
                <div class="mb-3">
                    <label class="form-label">Cupom de desconto</label>
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="form-control" 
                            placeholder="Digite o cupom"
                            [(ngModel)]="discountCoupon">
                        <button 
                            class="btn btn-outline-success" 
                            type="button" 
                            (click)="applyDiscountCoupon()">
                            APLICAR
                        </button>
                    </div>
                </div>

                <!-- Informa√ß√µes adicionais -->
                <div class="mt-3 p-2 bg-light rounded">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        {{ services.length }} servi√ßo(s) selecionado(s)
                    </small>
                </div>

                <!-- Bot√£o Finalizar fixo -->
                <div class="mt-3">
                    <button 
                        type="button" 
                        class="btn btn-success w-100 btn-finalizar-fixed" 
                        (click)="finalizeOrder()"
                        [disabled]="!isReadyToFinalize || isFinalizingshowing || services.length === 0">
                        <i class="fas fa-check me-2" *ngIf="!isFinalizingshowing"></i>
                        <i class="fas fa-spinner fa-spin me-2" *ngIf="isFinalizingshowing"></i>
                        {{ isFinalizingshowing ? 'Finalizando...' : 'Finalizar Ordem de Servi√ßo' }}
                    </button>
                    
                    <div class="mt-2" *ngIf="!isReadyToFinalize">
                        <small class="text-danger">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            Preencha todos os dados obrigat√≥rios
                        </small>
                    </div>
                    
                    <div class="mt-2" *ngIf="services.length === 0">
                        <small class="text-warning">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            Adicione pelo menos um servi√ßo
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
