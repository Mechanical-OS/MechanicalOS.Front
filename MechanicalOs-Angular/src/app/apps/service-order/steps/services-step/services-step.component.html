<div class="row">
    <!-- Seção de serviços -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Serviços a serem realizados...</h5>
                
                <!-- Campo de busca -->
                <div class="services-search-section">
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="form-control" 
                            placeholder="Pesquise por código ou descrição"
                            [(ngModel)]="searchValue"
                            (keyup.enter)="onSearchServices()">
                        <button 
                            class="btn btn-outline-secondary" 
                            type="button" 
                            (click)="onSearchServices()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- Lista de serviços disponíveis -->
                <div class="mb-4" *ngIf="searchValue">
                    <h6>Serviços disponíveis:</h6>
                    <div class="list-group">
                        <div class="list-group-item d-flex justify-content-between align-items-center available-service-item" 
                             *ngFor="let service of getFilteredServices()">
                            <div>
                                <strong>{{ service.name }}</strong><br>
                                <small class="text-muted">R$ {{ service.price.toFixed(2).replace('.', ',') }}</small>
                            </div>
                            <div class="action-buttons">
                                <button 
                                    class="btn btn-sm btn-add-service" 
                                    (click)="addService(service)">
                                    <i class="fas fa-plus"></i> Adicionar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabela de serviços selecionados -->
                <div class="services-table-container" *ngIf="services.length > 0">
                    <table class="table table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>SERVIÇO</th>
                                <th>Preço</th>
                                <th>Quantidade</th>
                                <th>Total</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let service of services; let i = index">
                                <td>{{ service.name }}</td>
                                <td>R$ {{ service.price.toFixed(2).replace('.', ',') }}</td>
                                <td>
                                    <input 
                                        type="number" 
                                        class="form-control form-control-sm" 
                                        style="width: 80px;"
                                        [value]="service.quantity"
                                        min="1"
                                        (change)="updateServiceQuantity(i, $any($event.target).value)"
                                        (input)="updateServiceQuantity(i, $any($event.target).value)">
                                </td>
                                <td>R$ {{ service.total.toFixed(2).replace('.', ',') }}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button 
                                            class="btn btn-sm btn-outline-danger" 
                                            (click)="removeService(i)"
                                            title="Remover serviço">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Seção de observações -->
                <div class="mt-4">
                    <h6>Adicionar observação</h6>
                    <textarea 
                        class="form-control" 
                        rows="4" 
                        placeholder="Digite suas observações aqui..."
                        [(ngModel)]="observations"
                        (blur)="updateObservations()">
                    </textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Seção de resumo do orçamento -->
    <div class="col-md-4">
        <div class="card resumo-orcamento-fixed">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-calculator me-2"></i>Resumo do orçamento
                </h5>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Sub total:</span>
                        <span><strong>R$ {{ subtotal.toFixed(2).replace('.', ',') }}</strong></span>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Desconto:</span>
                        <span class="text-danger">- R$ {{ discount.toFixed(2).replace('.', ',') }}</span>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Taxas:</span>
                        <span>R$ 0,00</span>
                    </div>
                </div>

                <hr>

                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span><strong>Total:</strong></span>
                        <span><strong class="text-success fs-5">R$ {{ total.toFixed(2).replace('.', ',') }}</strong></span>
                    </div>
                </div>

                <!-- Campo de cupom de desconto -->
                <div class="mb-3">
                    <label class="form-label">Cupom de desconto</label>
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="form-control" 
                            placeholder="Digite o cupom"
                            [(ngModel)]="discountCoupon">
                        <button 
                            class="btn btn-outline-success" 
                            type="button" 
                            (click)="applyDiscountCoupon()">
                            APLICAR
                        </button>
                    </div>
                </div>

                <!-- Informações adicionais -->
                <div class="mt-3 p-2 bg-light rounded">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        {{ services.length }} serviço(s) selecionado(s)
                    </small>
                </div>

                <!-- Botão Finalizar fixo -->
                <div class="mt-3">
                    <button type="button" class="btn btn-success w-100 btn-finalizar-fixed" (click)="finalizeOrder()">
                        <i class="fas fa-check me-2"></i>Finalizar Ordem de Serviço
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
