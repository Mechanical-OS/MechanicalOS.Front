<app-page-title [breadcrumbItems]="pageTitle" title=""></app-page-title>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="mb-4">
                    <h4 class="fw-bold">
                        {{ isEditMode ? 'Editar Veículo' : 'Cadastro de Veículos' }}
                    </h4>
                </div>

                <div class="row">
                    <!-- Coluna da imagem e histórico -->
                    <div class="col-md-4 text-center" style="margin-top: 15%;">
                        <div class="upload-box mb-3">
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                <p class="mb-0">Arraste a imagem aqui, ou clique.</p>
                                <small class="text-muted">foto do veículo</small>
                            </div>
                        </div>
                        <a class="text-success fw-bold" href="#">
                            BUSCAR PLACA <i class="fas fa-wrench"></i>
                        </a>
                    </div>

                    <div class="col-md-8" style="border: 1px dashed #ccc;">
                        <form [formGroup]="form">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div style="flex:1;">
                                            <app-selectize  
                                                    placeholder="Selecione a marca"
                                                    [items]="brands"
                                                    [control]="brandControl"
                                                    [label]="'Marca'"
                                                    (selectionChange)="onSelectBrandChange($event)">
                                            </app-selectize>
                                        </div>
                                        <div class="ms-2">
                                            <button type="button" class="btn btn-link p-0 text-success" (click)="openBrandModal()" aria-label="Adicionar marca" title="Adicionar marca">
                                                <i class="fas fa-plus-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div style="flex:1;">
                                            <app-selectize  
                                                    placeholder="Selecione o modelo"
                                                    [items]="vehicleModels"
                                                    [control]="vehicleModelControl"
                                                    [label]="'Modelo'"
                                                    (selectionChange)="onSelectVehicleModelChange($event)">
                                            </app-selectize>
                                        </div>
                                        <div class="ms-2">
                                            <button type="button" class="btn btn-link p-0 text-success" (click)="openModelModal()" aria-label="Adicionar modelo" title="Adicionar modelo">
                                                <i class="fas fa-plus-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--ROW-->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="version" class="form-label">Versão</label>
                                    <input id="version" formControlName="version" class="form-control"
                                        [ngClass]="{'is-invalid': (form.get('version')?.invalid && form.get('version')?.touched)}" />

                                    <div class="invalid-feedback">
                                        <span
                                            style="font-weight: bold; color: #b91c1c;">{{messageValidationService.getErrorMessage(form.get('version'),
                                            'Versão')}}</span>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="year" class="form-label">Ano (fabricação)</label>
                                    <input id="year" formControlName="year" class="form-control"
                                        [ngClass]="{'is-invalid': (form.get('year')?.invalid && form.get('year')?.touched)}" />

                                    <div class="invalid-feedback">
                                        <span
                                            style="font-weight: bold; color: #b91c1c;">{{messageValidationService.getErrorMessage(form.get('year'),
                                            'Ano')}}</span>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="chassi" class="form-label">Chassi</label>
                                    <input id="chassi" formControlName="chassi" class="form-control"
                                        [ngClass]="{'is-invalid': (form.get('chassi')?.invalid && form.get('chassi')?.touched)}" />

                                    <div class="invalid-feedback">
                                        <span
                                            style="font-weight: bold; color: #b91c1c;">{{messageValidationService.getErrorMessage(form.get('chassi'),
                                            'Chassi')}}</span>
                                    </div>
                                </div>
                            </div>
                            <!--ROW-->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div style="flex:1;">
                                            <app-selectize  
                                                    placeholder="Selecione a cor"
                                                    [items]="colors"
                                                    [control]="colorControl"
                                                    [label]="'Cor'"
                                                    (selectionChange)="onSelectColorChange($event)">
                                            </app-selectize>
                                        </div>
                                        <div class="ms-2">
                                            <button type="button" class="btn btn-link p-0 text-success" (click)="openColorModal()" aria-label="Adicionar cor" title="Adicionar cor">
                                                <i class="fas fa-plus-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <app-selectize  
                                            placeholder="Selecione"
                                            [items]="transmissions"
                                            [control]="transmissionControl"
                                            [label]="'Cambio (transmissão)'"
                                            (selectionChange)="onSelectTrasmissionChange($event)">
                                    </app-selectize>
                                </div>

                                <div class="col-md-4">
                                    <label for="engine" class="form-label">Motor</label>
                                    <input id="engine" formControlName="engine" class="form-control"
                                        [ngClass]="{'is-invalid': (form.get('engine')?.invalid && form.get('engine')?.touched)}" />

                                    <div class="invalid-feedback">
                                        <span
                                            style="font-weight: bold; color: #b91c1c;">{{messageValidationService.getErrorMessage(form.get('engine'),
                                            'Motor')}}</span>
                                    </div>
                                </div>
                            </div>
                            <!--ROW-->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="plate" class="form-label">Placa</label>
                                    <input id="plate" formControlName="plate" class="form-control"
                                        [ngClass]="{'is-invalid': (form.get('plate')?.invalid && form.get('plate')?.touched)}" />

                                    <div class="invalid-feedback">
                                        <span
                                            style="font-weight: bold; color: #b91c1c;">{{messageValidationService.getErrorMessage(form.get('plate'),
                                            'Placa')}}</span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--MENU-->
<app-metro-menu [orientation]="'horizontal'" 
                [buttons]="menuButtons"
                (buttonClick)="handleMenuAction($event)"></app-metro-menu>
<!-- Modal: Nova Marca -->
<ng-template #brandModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Nova Marca</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="mb-3">
            <label for="newBrandName" class="form-label">Nome da marca</label>
            <input id="newBrandName" type="text" class="form-control" [(ngModel)]="newBrandName" placeholder="Digite o nome da marca" />
        </div>
        <div class="mb-3">
            <label for="newBrandDescription" class="form-label">Descrição</label>
            <input id="newBrandDescription" type="text" class="form-control" [(ngModel)]="newBrandDescription" placeholder="Digite a descrição da marca" />
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="modal.dismiss()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="SaveNewBrand(modal)">Salvar</button>
    </div>
</ng-template>

<!-- Modal: Novo Modelo -->
<ng-template #modelModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Novo Modelo</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="mb-3">
            <label for="newModelName" class="form-label">Nome do modelo</label>
            <input id="newModelName" type="text" class="form-control" [(ngModel)]="newModelName" placeholder="Digite o nome do modelo" />
        </div>
        <div class="mb-3">
            <label for="newModelDescription" class="form-label">Descrição</label>
            <input id="newModelDescription" type="text" class="form-control" [(ngModel)]="newModelDescription" placeholder="Digite a descrição do modelo" />
        </div>
        <div class="mb-3">
            <label class="form-label">Marca</label>
            <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                {{ selectedBrandName || 'Nenhuma marca selecionada' }}
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="modal.dismiss()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="SaveNewModel(modal)" [disabled]="!brandControl.value">Salvar</button>
    </div>
</ng-template>

<!-- Modal: Nova Cor -->
<ng-template #colorModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Nova Cor</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="mb-3">
            <label for="newColorName" class="form-label">Nome da cor</label>
            <input id="newColorName" type="text" class="form-control" [(ngModel)]="newColorName" placeholder="Digite o nome da cor" />
        </div>
        <div class="mb-3">
            <label for="newColorDescription" class="form-label">Descrição</label>
            <input id="newColorDescription" type="text" class="form-control" [(ngModel)]="newColorDescription" placeholder="Digite a descrição da cor" />
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="modal.dismiss()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="SaveNewColor(modal)">Salvar</button>
    </div>
</ng-template>